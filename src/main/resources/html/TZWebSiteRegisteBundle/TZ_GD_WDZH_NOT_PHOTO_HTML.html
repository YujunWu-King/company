<!--meta http-equiv="X-UA-Compatible" content="IE=9"-->
<!--link rel="stylesheet" type="text/css" href="/tranzvision/css/css.css"/-->
<script type="text/javascript" src="%bind(:25)/statics/js/lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="%bind(:25)/statics/js/tranzvision/func/custom_radio.js"></script>
<script type="text/javascript" src="%bind(:25)/statics/js/lib/laydate/laydate.js"></script>
<script type="text/javascript" src="%bind(:25)/statics/js/tranzvision/util/layer.js"></script>
<script type="text/javascript">
	function MM_goToURL() {
	  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;
	  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");
	}
</script>
<script type="text/javascript">
	var jsonValue;
	var email_url="";
	var mobile_url="";
var isBindEmail = "";
var isBindMobile = "";

	function myrefresh(){ 
		window.location.reload(); 
	}
	$(document).ready(function(){
		$("#BIRTHDATE").click(function() {
			laydate();
		});
		$.each([$("#TZ_COUNTRY"),$("#TZ_COUNTRY_click")],function(i,el){
			el.click(function(e) {
				var countryUrl = encodeURI('%BIND(:24)');
			   	$("#ParamCon").val("TZ_COUNTRY");
				s = $.layer({
					type: 2,
					title: false,
					fix: false,
					closeBtn: false,
					shadeClose: false,
					shade : [0.3 , '#000' , true],
					border : [3 , 0.3 , '#000', true],
					offset: ['50%',''],
					area: ['830px','610px'],
					iframe: {src: countryUrl},
				});
			});
		});
		$("#TZ_COUNTRY_click").mouseover(function() {
		   	$("#TZ_COUNTRY_click").css("cursor","pointer");
		});
		$("#TZ_COUNTRY_click").mouseout(function() {
		   	$("#TZ_COUNTRY_click").css("cursor","");
		});
		$.each([$("#TZ_SCH_CNAME"),$("#TZ_SCH_CNAME_click")],function(i,el){
			el.click(function(e) {
				$("#ParamValue").val("TZ_SCH_CNAME");
				s = $.layer({
					type: 2,
					title: false,
					fix: false,
					closeBtn: false,
					shadeClose: false,
					shade : [0.3 , '#000' , true],
					border : [3 , 0.3 , '#000', true],
					offset: ['50%',''],
					area: ['830px','720px'],
					iframe: {src: '/mba/colselector_liu.html'}
				});
			});
        });
		$("#TZ_SCH_CNAME_click").mouseover(function() {
		   	$("#TZ_SCH_CNAME_click").css("cursor","pointer");
		});
		$("#TZ_SCH_CNAME_click").mouseout(function() {
		   	$("#TZ_SCH_CNAME_click").css("cursor","");
		});
		$.each([$("#TZ_LEN_PROID"),$("#TZ_LEN_PROID_click")],function(i,el){
			el.click(function(e) { 
				var _prov_id = "TZ_LEN_PROID";
				var provUrl = encodeURI('%BIND(:11)');
				prov = $.layer({
					type: 2,
					title: false,
					fix: false,
					closeBtn: false,
					shadeClose: false,
					shade : [0.3 , '#000' , true],
					border : [3 , 0.3 , '#000', true],
					offset: ['100px',''],
					area: ['588px','300px'],
					iframe: {src: provUrl}
				});
			});
        });
		$("#TZ_LEN_PROID_click").mouseover(function() {
		   	$("#TZ_LEN_PROID_click").css("cursor","pointer");
		});
		$("#TZ_LEN_PROID_click").mouseout(function() {
		   	$("#TZ_LEN_PROID_click").css("cursor","");
		});
		$.each([$("#TZ_LEN_CITY"),$("#TZ_LEN_CITY_click")],function(i,el){
			el.click(function(e) { 
				var _city_id = "TZ_LEN_CITY";
				var cityUrl = encodeURI('%BIND(:12)');
				i2 = $.layer({
					type: 2,
					title: false,
					fix: false,
					closeBtn: false,
					shadeClose: false,
					shade : [0.3 , '#000' , true],
					border : [3 , 0.3 , '#000', true],
					offset: ['100px',''],
					area: ['588px','400px'],
					iframe: {src: cityUrl}
				});
			});
        });
		$("#TZ_LEN_CITY_click").mouseover(function() {
		   	$("#TZ_LEN_CITY_click").css("cursor","pointer");
		});
		$("#TZ_LEN_CITY_click").mouseout(function() {
		   	$("#TZ_LEN_CITY_click").css("cursor","");
		});

		$.ajax({
			type:"post",
			dataType:"json",
			async:false,
			url:'%bind(:8)',
			success:function(jsonData){
				jsonValue= jsonData.comContent;
				var data = jsonData.comContent;

				//个人设置
				for (var key in data)
			    {
					if(key == "TZ_GENDER"){
						$("input[name='TZ_GENDER'][value='" + data[key] + "']").attr("checked","checked");
					}else{
						$("#" + key).val(data[key]);
					}
			    }
/*
				$("#userEmail").html(data.userEmail);
				$("#userMoblie").html(data.userMoblie);
				$("#photo").attr("src",data.userPhoto);
*/
				//通知设置
				if(data.isEmail == "Y"){
					$("#userEmailChecked").removeClass("toggle-off");
					$("#toggleOption1").attr("checked","checked");
					$("#toggleOption2").removeAttr("checked");
				}else{
					$("#toggleOption2").attr("checked","checked");
					$("#toggleOption1").removeAttr("checked");
				}
				if(data.isMobile == "Y"){
					$("#userMoblieChecked").removeClass("toggle-off");
					$("#toggleOption3").attr("checked","checked");
					$("#toggleOption4").removeAttr("checked");
				}else{
					$("#toggleOption4").attr("checked","checked");
					$("#toggleOption3").removeAttr("checked");
				}


				//账号绑定
				/*
				$("#BindEmail").html(data.userEmail);
				$("#BindMobile").html(data.userMoblie);
				if(data.isBindEmail == "Y"){
					$("#bind_Email").html("解除绑定");
				}else{
					$("#bind_Email").html("绑定邮箱");
				}
				if(data.isBindMobile == "Y"){
					$("#bind_Mobile").html("解除绑定");
				}else{
					$("#bind_Mobile").html("绑定手机");
				}*/
isBindEmail = data.isBindEmail;
isBindMobile = data.isBindMobile;

				email_url = data.bindEmailURL;
				mobile_url = data.bindMobileURL;
				
			}
		});
		//保存个人信息
		$("#saveper").click( function(){
			var date1 = "";
			var userInfoJson = {};
			for (var key in jsonValue)
		    {
/*****
				if(date1 == ""){
					 date1 = key + "=" + encodeURI($("#" + key).val());
				}else{
					if(key == "TZ_GENDER"){
					 	date1 = date1 + "&" + key + "=" + encodeURI($("input[name='TZ_GENDER']:checked").val());
 
					}else{
						date1 = date1 + "&" + key + "=" + encodeURI($("#" + key).val());
					}
				}
*****/
				if(key == "TZ_GENDER"){
                     userInfoJson[key] = $("input[name='TZ_GENDER']:checked").val();
				}else{
						userInfoJson[key] = $("#" + key).val();
				}
		    }
        /*  date1 = date1+"&lang="+$("#lang").val();  */
		  userInfoJson["jgid"] = $("#jgid").val();
		  userInfoJson["lang"] = $("#lang").val();


		   
		  var tzParams = '{"ComID":"TZ_GD_ZS_USERMNG","PageID":"TZ_ZS_USERMNG_STD","OperateType":"SAVEUSERINFO","comParams":' + JSON.stringify( userInfoJson ) + '}';


			$.ajax({
				type:"post",
				dataType:"json",
				async:false,
				data: {"tzParams" : tzParams },				
				url:'%bind(:1)',
				success:function(data){	
					alert(data.comContent.success);
				}
			});
	  	});
		//保存通知设置
		$("#saveRemind").click( function(){

			var lang = $("#lang").val();
			var isEmail = $("#toggleOption1").prop("checked");
			var isMoblie = $("#toggleOption3").prop("checked");

			var notice = {"isEmail": isEmail, "isMoblie": isMoblie, "lang": lang};

			var tzParams = '{"ComID":"TZ_GD_ZS_USERMNG","PageID":"TZ_ZS_USERMNG_STD","OperateType":"NOTICE","comParams":' + JSON.stringify( notice ) + '}';

			$.ajax({
				type:"post",
				dataType:"json",
				async:false,
				data: {"tzParams" : tzParams },					
				url:"%bind(:9)",
				success:function(data){	
					alert(data.comContent.success);
				}
			});
	  	});
	})
	//绑定/解绑邮箱
	function changeBindEmail(){
		  var lang = $("#lang").val();
 		  var bindOrUnbindEmail = {"lang": lang , "BIND": isBindEmail};
		  var tzParams = '{"ComID":"TZ_GD_ZS_USERMNG","PageID":"TZ_ZS_USERMNG_STD","OperateType":"EMAIL","comParams":' + JSON.stringify( bindOrUnbindEmail ) + '}';

		$.ajax({
			type:"post",
			dataType:"json",
			async:false,			
			url:email_url,
            data: {"tzParams" : tzParams },	
			success:function(data){
				if(data.comContent.success == "Y"){
					email_url = data.comContent.url;
					isBindEmail = data.comContent.BIND;
					if(data.comContent.BIND == "Y"){
						$("#bind_Email").html("%bind(:21)");
						$("#BindEmail").html(data.comContent.email);
						$("#change_Email").show();
					}else{
						$("#BindEmail").html("%bind(:22)");
						$("#bind_Email").html("%bind(:20)");
						$("#change_Email").hide();
					}
					alert("%bind(:23)");
				}else{
					alert(data.comContent.errorDesc);
				}
			}
		});
	}

	//绑定/解绑手机
	function changeBindMobile(){
 		  var lang = $("#lang").val();
 		  var bindOrUnbindMobile = {"lang": lang , "BIND": isBindMobile};
		  var tzParams = '{"ComID":"TZ_GD_ZS_USERMNG","PageID":"TZ_ZS_USERMNG_STD","OperateType":"MOBILE","comParams":' + JSON.stringify( bindOrUnbindMobile ) + '}';

		$.ajax({
			type:"post",
			dataType:"json",
			async:false,			
			url:mobile_url,
			data: {"tzParams" : tzParams },	
			success:function(data){
				if(data.comContent.success == "Y"){
					mobile_url = data.comContent.url;
					isBindMobile = data.comContent.BIND;
					if(data.comContent.BIND == "Y"){
						$("#bind_Mobile").html("%bind(:21)");
					}else{
						$("#BindMobile").html("%bind(:22)");
						$("#bind_Mobile").html("%bind(:20)");
						$("#change_Mobile").hide();
					}
					alert("%bind(:23)");
				}else{
					alert(data.comContent.errorDesc);
				}
			}
		});
	}
</script>
<script type="text/javascript">
	function setTab(m,n){
		var menu=document.getElementById("tab" + m).getElementsByTagName("li");  
		var showdiv=$("#content" + m + " .tab1"); 
	 	for(i=0;i<menu.length;i++)
		{
		   menu[i].className=i==n?"now":""; 
		   showdiv[i].style.display=i==n?"block":"none"; 
		}
	}
</script>
<!-- content start -->

	<div class="main_inner">
	    <div class="main_inner_title">
	      <div class="main_inner_title_text_wide">%bind(:13)</div>
	    </div>
	    <div class="mian_inner_nav" id="tab1">
			<div class="float_left">
		      <ul>
		        <li class="now" onclick="setTab(1,0)">%bind(:14)</li>
		        <li onclick="setTab(1,1)">%bind(:15)</li>
				<li onclick="setTab(1,2)">%bind(:17)</li>		
                 
             	<!--<li onclick="setTab(1,3)">%bind(:16)%bind(:18)</li> -->
		      </ul>
			</div>
	    </div>
		<div id="content1">
			<div class="tab1 block">
                <!-- 不带头像的html-->
			    <div class=".main_inner_right_2">
					<input type="hidden" id="ParamCon"/>
					<input type="hidden" id="ParamValue"/>
					%bind(:10)
					
				</div>
				<div class="main_all_line_center"></div>
				<div class="main_article_nav">
					<div class="center_bt">
				    	<div id="saveper" class="bt_blue">%bind(:19)</div>
				    </div>
				</div>
				<div class="padding_div_50px"></div>
			</div>
			<div class="tab1">%bind(:3)</div>

			<div class="tab1">%bind(:7)</div>
			<!--<div class="tab1">%bind(:6)</div>-->
		</div>
    	<div style="clear:both;"></div>
  	</div>

<!-- content end -->
<script type="text/javascript" src="%bind(:25)/statics/js/tranzvision/util/layer.js"></script>
<script type="text/javascript">	
	var up;
	function openUpload(){
        var photoUrl = encodeURI('%BIND(:2)');
		up = $.layer({
			type: 2,
			title: false,
			fix: false,
			closeBtn: 2,
			shadeClose: false,
			shade : [0.3 , '#000' , true],

			border : [3 , 0.3 , '#000', true],
			offset: ['50%',''],
			area: ['840px','610px'],
			iframe: {src:  photoUrl }
		});
	}
	function changeEmail(){
		var changeEmailUrl = encodeURI('%BIND(:4)');
		$.layer({
			type: 2,
			title: false,
			fix: false,
			closeBtn: 2,
			shadeClose: false,
			shade : [0.3 , '#000' , true],
			border : [3 , 0.3 , '#000', true],
			offset: ['100%',''],
			area: ['589px','306px'],
			iframe: {src:  changeEmailUrl+"?tzParams={'ComID':'TZ_SITE_UTIL_COM','PageID':'TZ_SITE_ENROLL_STD','OperateType':'HTML','comParams': {'siteid':'"+$("#siteid").val()+"','orgid':'"+$("#jgid").val() +"','lang':'"+$("#lang").val()+"','sen':'6'}}" }
		});
	}
	function changeMobile(){
        var changeMobileUrl = encodeURI('%BIND(:5)');
		$.layer({
			type: 2,
			title: false,
			fix: false,
			closeBtn: 2,
			shadeClose: false,
			shade : [0.3 , '#000' , true],
			border : [3 , 0.3 , '#000', true],
			offset: ['100%',''],
			area: ['589px','306px'],
			iframe: {src:  changeMobileUrl }
		});
	}

    function bindMobile(el){
		var attrState=$(el).attr("phoneBindState");
		if (attrState=="Y"){
			changeBindMobile();
		//	myrefresh();
			setTab(1,3);
		}else{
			changeMobile();
		}
	}

    function bindEmail(el){
		changeBindEmail();/*
		var attrState=$(el).attr("emailBindState");
		if (attrState=="Y"){
			changeBindEmail();
		//	myrefresh();
			setTab(1,3);
		}else{
			changeEmail();
		}
		*/
	}
</script>